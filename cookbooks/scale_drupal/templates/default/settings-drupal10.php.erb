<?php

/*
 * This file is included from the main settings.php which controls
 * most of the config from the scale-drupal repo - this is just here
 * to add secrets.
 */

/**
 * Database settings:
 *
 * The $databases array specifies the database connection or
 * connections that Drupal may use.  Drupal is able to connect
 * to multiple databases, including multiple types of databases,
 * during the same request.
 *
 * One example of the simplest connection array is shown below. To use the
 * sample settings, copy and uncomment the code below between the @code and
 * @endcode lines and paste it after the $databases declaration. You will need
 * to replace the database username and password and possibly the host and port
 * with the appropriate credentials for your database system.
 *
 * The next section describes how to customize the $databases array for more
 * specific needs.
 *
 * @code
 * $databases['default']['default'] = [
 *   'database' => 'database_name',
 *   'username' => 'sql_username',
 *   'password' => 'sql_password',
 *   'host' => 'localhost',
 *   'port' => '3306',
 *   'driver' => 'mysql',
 *   'prefix' => '',
 *   'collation' => 'utf8mb4_general_ci',
 * ];
 * @endcode
 */
$databases['default']['default'] = [
  'database' => '<%= node['scale_drupal']['drupal_database'] %>',
  'username' => '<%= node['fb_init']['secrets']['drupal_username'] %>',
  'password' => '<%= node['fb_init']['secrets']['drupal_password'] %>',
  'host' => '<%= node['scale_drupal']['mysql_host'] %>',
  'port' => '',
  'driver' => 'mysql',
  'prefix' => '',
];

<% if node['hostname'] == 'scale-web-centos10-staging' %>
$databases['default']['default']['pdo'] = [
  PDO::MYSQL_ATTR_SSL_CA => '/etc/ssl/certs/rds-combined-ca-bundle.pem',
  PDO::MYSQL_ATTR_SSL_VERIFY_SERVER_CERT => true,
];
<% end %>

/**
 * Salt for one-time login links, cancel links, form tokens, etc.
 *
 * This variable will be set to a random value by the installer. All one-time
 * login links will be invalidated if the value is changed. Note that if your
 * site is deployed on a cluster of web servers, you must ensure that this
 * variable has the same value on each server.
 *
 * For enhanced security, you may set this variable to the contents of a file
 * outside your document root, and vary the value across environments (like
 * production and development); you should also ensure that this file is not
 * stored with backups of your database.
 *
 * Example:
 * @code
 *   $settings['hash_salt'] = file_get_contents('/home/example/salt.txt');
 * @endcode
 */
$settings['hash_salt'] = '<%= node['fb_init']['secrets']['drupal_hash_salt'] %>';
